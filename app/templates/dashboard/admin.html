{% extends "base.html" %}
{% block title %}Admin Dashboard | PhysiHome{% endblock %}
{% block content %}
<section class="admin-dashboard" data-admin-dashboard>
  <header class="auth-header">
    <h1>Admin Dashboard</h1>
    <p>Manage users and doctor verifications</p>
  </header>

  <div class="tabs" data-tab-group>
    <button class="tab-btn active" type="button" data-tab-target="users">Users</button>
    <button class="tab-btn" type="button" data-tab-target="doctors">Verified Doctors</button>
    <button class="tab-btn" type="button" data-tab-target="pending">Pending Verification</button>
  </div>

  <div id="users" class="tab-content active" data-tab-panel="users">
    <h2>All Users</h2>
    <div class="card-list">
      {% for u in users %}
      <article class="card user-card">
        <header>
          <img src="{{ u.avatar_url }}" alt="{{ u.name }}" />
          <div>
            <h3>{{ u.name }}</h3>
            <p>{{ u.email }}</p>
          </div>
        </header>
        <p>Role: {{ u.role }}</p>
        {% if u.gender %}
        <p>Gender: {{ u.gender|title }}</p>
        {% endif %}
        {% if u.doctor_verification_status %}
        <p>Status: {{ u.doctor_verification_status }}</p>
        {% endif %}
      </article>
      {% endfor %}
      {% if users|length == 0 %}
      <p class="muted">No users yet.</p>
      {% endif %}
    </div>
  </div>

  <div id="doctors" class="tab-content" data-tab-panel="doctors">
    <h2>Verified Doctors</h2>
    <div class="card-list">
      {% for d in doctors %}
      <article class="card user-card">
        <header>
          <img src="{{ d.avatar_url }}" alt="{{ d.name }}" />
          <div>
            <h3>{{ d.name }}</h3>
            <p>{{ d.email }}</p>
          </div>
        </header>
        <p>Specialization: {{ d.specialization or 'General' }}</p>
      </article>
      {% endfor %}
      {% if doctors|length == 0 %}
      <p class="muted">No verified doctors yet.</p>
      {% endif %}
    </div>
  </div>

  <div id="pending" class="tab-content" data-tab-panel="pending">
    <h2>Pending Verification</h2>
    <div class="card-list">
      {% for p in pending %}
      <article class="card user-card">
        <header>
          <img src="{{ p.avatar_url }}" alt="{{ p.name }}" />
          <div>
            <h3>{{ p.name }}</h3>
            <p>{{ p.email }}</p>
          </div>
        </header>
        <p>Status: {{ p.doctor_verification_status }}</p>
        <div class="documents">
          {% if p.self_photo_url %}
          <div>
            <h4>Self Photo</h4>
            <button class="doc-thumb" type="button" data-zoom-src="{{ p.self_photo_url }}" data-zoom-label="Self Photo">
              <img src="{{ p.self_photo_url }}" alt="Self Photo" />
              <span class="doc-thumb-action">Zoom</span>
            </button>
          </div>
          {% endif %}
          {% if p.degree_photo_url %}
          <div>
            <h4>Degree</h4>
            <button class="doc-thumb" type="button" data-zoom-src="{{ p.degree_photo_url }}" data-zoom-label="Degree certificate">
              <img src="{{ p.degree_photo_url }}" alt="Degree" />
              <span class="doc-thumb-action">Zoom</span>
            </button>
          </div>
          {% endif %}
          {% if p.visiting_card_url %}
          <div>
            <h4>Visiting Card</h4>
            <button class="doc-thumb" type="button" data-zoom-src="{{ p.visiting_card_url }}" data-zoom-label="Visiting card">
              <img src="{{ p.visiting_card_url }}" alt="Visiting Card" />
              <span class="doc-thumb-action">Zoom</span>
            </button>
          </div>
          {% endif %}
        </div>
        <div class="actions">
          <button class="btn primary" onclick="approveDoctor('{{ p._id }}')">Approve</button>
          <button class="btn ghost" onclick="rejectDoctor('{{ p._id }}')">Reject</button>
        </div>
      </article>
      {% endfor %}
      {% if pending|length == 0 %}
      <p class="muted">No pending requests.</p>
      {% endif %}
    </div>
  </div>
</section>
{% endblock %}
